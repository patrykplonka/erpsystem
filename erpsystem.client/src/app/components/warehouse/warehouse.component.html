<div class="warehouse-container">
  <aside class="sidebar">
    <h2>Dashboard</h2>
    <ul>
      <li><a href="#">üìä Statystyki</a></li>
      <li><button (click)="goToWarehouse()">üì¶ Magazyn</button></li>
      <li><a href="#">üìÑ Faktury</a></li>
      <li><a href="#">üë§ Klienci</a></li>
      <li><a href="#">‚öôÔ∏è Ustawienia</a></li>
      <li><button (click)="logout()">üö™ Wyloguj</button></li>
    </ul>
  </aside>

  <main class="main-content">
    <header>
      <div class="header-title">
        <h1>üì¶ Magazyn</h1>
        <p>ZarzƒÖdzaj produktami w magazynie</p>
      </div>
      <div class="user-info">
        <p>Zalogowany jako: <strong>{{ currentUserEmail || 'Brak danych u≈ºytkownika' }}</strong></p>
      </div>
    </header>

    <section class="warehouse-section">
      <div class="messages">
        <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
        <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
      </div>

      <div class="forms-container">
        <div class="add-item-form" *ngIf="showAddForm && !editItem">
          <h3>Dodaj nowy produkt</h3>
          <form (ngSubmit)="addItem()">
            <input [(ngModel)]="newItem.name" name="name" placeholder="Nazwa" required>
            <input [(ngModel)]="newItem.code" name="code" placeholder="Kod" required>
            <input [(ngModel)]="newItem.quantity" name="quantity" type="number" placeholder="Ilo≈õƒá" min="0" required>
            <input [(ngModel)]="newItem.price" name="price" type="number" step="0.01" placeholder="Cena" min="0" required>
            <input [(ngModel)]="newItem.category" name="category" placeholder="Kategoria" required>
            <select [(ngModel)]="newItem.location" name="location" required>
              <option value="" disabled selected>Wybierz lokalizacjƒô</option>
              <option *ngFor="let loc of availableLocations" [value]="loc.name">{{ loc.name }}</option>
            </select>
            <div class="form-buttons">
              <button type="submit">Dodaj</button>
              <button type="button" class="cancel-button" (click)="toggleAddForm()">Anuluj</button>
            </div>
          </form>
        </div>

        <div class="add-item-form" *ngIf="editItem">
          <h3>Edytuj produkt</h3>
          <form (ngSubmit)="updateItem()">
            <input [(ngModel)]="editItem.name" name="name" placeholder="Nazwa" required>
            <input [(ngModel)]="editItem.code" name="code" placeholder="Kod" required>
            <input [(ngModel)]="editItem.quantity" name="quantity" type="number" placeholder="Ilo≈õƒá" min="0" required>
            <input [(ngModel)]="editItem.price" name="price" type="number" step="0.01" placeholder="Cena" min="0" required>
            <input [(ngModel)]="editItem.category" name="category" placeholder="Kategoria" required>
            <select [(ngModel)]="editItem.location" name="location" required>
              <option value="" disabled>Wybierz lokalizacjƒô</option>
              <option *ngFor="let loc of availableLocations" [value]="loc.name">{{ loc.name }}</option>
            </select>
            <div class="form-buttons">
              <button type="submit">Zapisz</button>
              <button type="button" class="cancel-button" (click)="cancelEdit()">Anuluj</button>
            </div>
          </form>
        </div>

        <div class="add-item-form" *ngIf="showMoveForm && itemToMoveId">
          <h3>Przenie≈õ produkt</h3>
          <form (ngSubmit)="submitMove()">
            <select [(ngModel)]="selectedLocation" name="selectedLocation" required>
              <option value="" disabled selected>Wybierz nowƒÖ lokalizacjƒô</option>
              <option *ngFor="let loc of availableLocations" [value]="loc.name">{{ loc.name }}</option>
            </select>
            <div class="form-buttons">
              <button type="submit">Przenie≈õ</button>
              <button type="button" class="cancel-button" (click)="cancelMove()">Anuluj</button>
            </div>
          </form>
        </div>
      </div>

      <div class="items-list">
        <div class="list-controls">
          <button class="add-button" (click)="toggleAddForm()" *ngIf="!showAddForm && !editItem && !showMoveForm && !showHistory">Dodaj nowy produkt</button>
          <button class="toggle-deleted" (click)="toggleDeletedView()">{{ showDeleted ? 'Poka≈º aktywne produkty' : 'Poka≈º usuniƒôte produkty' }}</button>
          <button class="toggle-history" (click)="toggleHistoryView()">{{ showHistory ? 'Ukryj historiƒô' : 'Poka≈º historiƒô' }}</button>
        </div>

        <div class="filters">
          <input [(ngModel)]="nameFilter" placeholder="Nazwa lub kod">
          <input [(ngModel)]="quantityFilter" type="number" placeholder="Ilo≈õƒá">
          <input [(ngModel)]="priceFilter" type="number" step="0.01" placeholder="Cena">
          <input [(ngModel)]="categoryFilter" placeholder="Kategoria">
          <input [(ngModel)]="locationFilter" placeholder="Lokalizacja">
        </div>

        <table>
          <thead>
            <tr>
              <th>Nazwa</th>
              <th>Kod</th>
              <th>Ilo≈õƒá</th>
              <th>Cena</th>
              <th>Kategoria</th>
              <th>Lokalizacja</th>
              <th>Akcje</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredItems">
              <td>{{ item.name }}</td>
              <td>{{ item.code }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.price | number:'1.2-2' }} PLN</td>
              <td>{{ item.category }}</td>
              <td>{{ item.location || 'Brak' }}</td>
              <td class="actions">
                <button *ngIf="!showDeleted" class="action-button edit-button" (click)="startEdit(item)">Edytuj</button>
                <button *ngIf="!showDeleted" class="action-button delete-button" (click)="deleteItem(item.id)">Usu≈Ñ</button>
                <button *ngIf="showDeleted" class="action-button restore-button" (click)="restoreItem(item.id)">Przywr√≥ƒá</button>
                <button *ngIf="!showDeleted" class="action-button move-button" (click)="startMove(item.id)">Przenie≈õ</button>
                <button *ngIf="!showDeleted" class="action-button" (click)="toggleMovements(item.id)">Ruchy</button>
              </td>
            </tr>
            <tr *ngIf="showMovements && selectedItemId">
              <td colspan="7">
                <div class="movements-container">
                  <h3>Ruchy magazynowe</h3>
                  <form (ngSubmit)="addMovement()">
                    <select [(ngModel)]="newMovement.movementType" name="movementType" required>
                      <option value="Receipt">Przyjƒôcie</option>
                      <option value="Issue">Wydanie</option>
                    </select>
                    <input type="number" [(ngModel)]="newMovement.quantity" name="quantity" placeholder="Ilo≈õƒá" min="1" required>
                    <textarea [(ngModel)]="newMovement.description" name="description" placeholder="Opis (opcjonalnie)" rows="4"></textarea>
                    <button type="submit">Zatwierd≈∫</button>
                  </form>
                  <h4>Historia ruch√≥w</h4>
                  <table>
                    <thead>
                      <tr>
                        <th>Typ</th>
                        <th>Ilo≈õƒá</th>
                        <th>Data</th>
                        <th>Opis</th>
                        <th>U≈ºytkownik</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let m of movements">
                        <td>{{ m.movementType === 'Receipt' ? 'Przyjƒôcie' : 'Wydanie' }}</td>
                        <td>{{ m.quantity }}</td>
                        <td>{{ m.date | date:'yyyy-MM-dd HH:mm' }}</td>
                        <td>{{ m.description || '-' }}</td>
                        <td>{{ m.createdBy }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="history-section" *ngIf="showHistory">
          <h3>Historia operacji</h3>
          <div class="history-filters">
            <input [(ngModel)]="historyUserFilter" placeholder="Filtruj po u≈ºytkowniku">
            <input [(ngModel)]="historyDateFilter" type="date">
            <input [(ngModel)]="historyItemFilter" placeholder="Filtruj po produkcie">
          </div>
          <div class="export-buttons">
            <button (click)="exportToExcel()">Eksportuj do Excel</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Operacja</th>
                <th>Produkt</th>
                <th>Data</th>
                <th>Szczeg√≥≈Çy</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of filteredOperationLogs">
                <td>{{ log.id }}</td>
                <td>{{ log.user }}</td>
                <td>{{ log.operation }}</td>
                <td>{{ log.itemName }} (ID: {{ log.itemId }})</td>
                <td>{{ log.timestamp | date:'yyyy-MM-dd HH:mm' }}</td>
                <td>{{ log.details }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>
