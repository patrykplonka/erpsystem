<div class="warehouse-container">
  <div class="dashboard-container">
    <aside class="sidebar">
      <h2>Dashboard</h2>
      <ul>
        <li>
          <button (click)="toggleWarehouseMenu()" [class.active]="isWarehouseOpen">
            ðŸ“¦ Magazyn
            <span class="arrow" [class.open]="isWarehouseOpen">â–¼</span>
          </button>
          <ul *ngIf="isWarehouseOpen" class="submenu">
            <li><button (click)="goToProducts()">Produkty</button></li>
            <li><button (click)="goToMovements()">Ruchy magazynowe</button></li>
            <li><button (click)="goToReports()">Raporty</button></li>
          </ul>
        </li>
        <li><button (click)="logout()">ðŸšª Wyloguj</button></li>
      </ul>
    </aside>
    <main class="main-content">
      <header>
        <div>
          <h1>Witaj w systemie ERP</h1>
          <p>ZarzÄ…dzaj ruchami magazynowymi w jednym miejscu</p>
        </div>
        <div class="user-info">
          <p>Zalogowany jako: <strong>{{ currentUserEmail || 'Brak danych uÅ¼ytkownika' }}</strong></p>
        </div>
      </header>
      <section class="warehouse-section">
        <div class="messages">
          <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
          <div class="alert alert-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
        </div>
        <div class="items-list">
          <table>
            <thead>
              <tr>
                <th>Nazwa</th>
                <th>Kod</th>
                <th>IloÅ›Ä‡</th>
                <th>Akcje</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of warehouseItems">
                <td data-label="Nazwa">{{ item.name }}</td>
                <td data-label="Kod">{{ item.code }}</td>
                <td data-label="IloÅ›Ä‡">{{ item.quantity }}</td>
                <td data-label="Akcje" class="actions">
                  <button class="action-button" (click)="toggleMovements(item.id)">
                    {{ showMovements && selectedItemId === item.id ? "Ukryj ruchy" : "Ruchy magazynowe" }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="movements-container" *ngIf="showMovements && selectedItemId">
            <form>
              <select [(ngModel)]="newMovement.movementType" name="movementType" required>
                <option value="PrzyjÄ™cie zewnÄ™trzne">PrzyjÄ™cie zewnÄ™trzne</option>
                <option value="PrzyjÄ™cie wewnÄ™trzne">PrzyjÄ™cie wewnÄ™trzne</option>
                <option value="Wydanie">Wydanie</option>
              </select>
              <select [(ngModel)]="newMovement.status" name="status" required>
                <option value="Zaplanowane">Zaplanowane</option>
                <option value="W trakcie">W trakcie</option>
                <option value="ZakoÅ„czone">ZakoÅ„czone</option>
              </select>
              <input [(ngModel)]="newMovement.quantity" type="number" placeholder="IloÅ›Ä‡" name="quantity" required min="1">
              <input [(ngModel)]="newMovement.supplier" placeholder="Dostawca" name="supplier">
              <input [(ngModel)]="newMovement.documentNumber" placeholder="Numer dokumentu" name="documentNumber">
              <textarea [(ngModel)]="newMovement.description" placeholder="Opis" name="description"></textarea>
              <textarea [(ngModel)]="newMovement.comment" placeholder="Komentarz" name="comment"></textarea>
              <button type="button" (click)="addMovement()">Dodaj ruch</button>
            </form>
            <div class="advanced-filters">
              <input [(ngModel)]="movementTypeFilter" placeholder="Filtruj po typie" (ngModelChange)="applyFilters()">
              <input [(ngModel)]="movementStatusFilter" placeholder="Filtruj po statusie" (ngModelChange)="applyFilters()">
              <input [(ngModel)]="movementStartDateFilter" type="date" placeholder="Od daty" (ngModelChange)="applyFilters()">
              <input [(ngModel)]="movementEndDateFilter" type="date" placeholder="Do daty" (ngModelChange)="applyFilters()">
              <input [(ngModel)]="movementUserFilter" placeholder="Filtruj po uÅ¼ytkowniku" (ngModelChange)="applyFilters()">
            </div>
            <h4>Ruchy magazynowe</h4>
            <table>
              <thead>
                <tr>
                  <th (click)="sortMovements('movementType')">Typ <span [ngClass]="{'sort-asc': movementSortField === 'movementType' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'movementType' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('status')">Status <span [ngClass]="{'sort-asc': movementSortField === 'status' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'status' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('quantity')">IloÅ›Ä‡ <span [ngClass]="{'sort-asc': movementSortField === 'quantity' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'quantity' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('supplier')">Dostawca <span [ngClass]="{'sort-asc': movementSortField === 'supplier' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'supplier' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('documentNumber')">Numer dokumentu <span [ngClass]="{'sort-asc': movementSortField === 'documentNumber' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'documentNumber' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('date')">Data <span [ngClass]="{'sort-asc': movementSortField === 'date' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'date' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('description')">Opis <span [ngClass]="{'sort-asc': movementSortField === 'description' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'description' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('comment')">Komentarz <span [ngClass]="{'sort-asc': movementSortField === 'comment' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'comment' && movementSortDirection === 'desc'}"></span></th>
                  <th (click)="sortMovements('createdBy')">UÅ¼ytkownik <span [ngClass]="{'sort-asc': movementSortField === 'createdBy' && movementSortDirection === 'asc', 'sort-desc': movementSortField === 'createdBy' && movementSortDirection === 'desc'}"></span></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let m of filteredMovements">
                  <td data-label="Typ">{{ m.movementType }}</td>
                  <td data-label="Status">{{ m.status }}</td>
                  <td data-label="IloÅ›Ä‡">{{ m.quantity }}</td>
                  <td data-label="Dostawca">{{ m.supplier }}</td>
                  <td data-label="Numer dokumentu">{{ m.documentNumber }}</td>
                  <td data-label="Data">{{ m.date }}</td>
                  <td data-label="Opis">{{ m.description }}</td>
                  <td data-label="Komentarz">{{ m.comment }}</td>
                  <td data-label="UÅ¼ytkownik">{{ m.createdBy }}</td>
                </tr>
              </tbody>
            </table>
            <div>
              <h3>Masowe dodawanie ruchÃ³w z CSV</h3>
              <input type="file" (change)="onFileChange($event)" accept=".csv">
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
